id: generate_docs
name: Generate Documentation
description: Generates comprehensive code documentation
extends: _base_code

parameters:
  branchPattern:
    type: string
    required: false
    default: "${'fix/' + (workItem.workItemType || 'task') + '-' + workItem.id}"
    description: Pattern for branch name
  commitMessage:
    type: string
    required: false
    default: "docs: improve code documentation\n\nAdds comprehensive JSDoc/TSDoc comments to improve code maintainability and developer experience.\n\nWork item: #${workItem.id}"
    description: Commit message template
  prTitle:
    type: string
    required: false
    default: "docs: improve code documentation"
    description: PR title template

variables:
  defaultBranch: "${workItem.defaultBranch || 'main'}"
  prDescription: |
    ## Description

    This PR adds comprehensive documentation to improve code maintainability.

    Work item: #${workItem.id}

    ## Changes

    - Added JSDoc/TSDoc comments to functions and methods
    - Documented classes and interfaces
    - Added file-level module documentation
    - Included usage examples where helpful

    ## Benefits

    - Improved developer onboarding
    - Better IDE autocomplete and hints
    - Easier code maintenance
    - Self-documenting codebase

    ---

    *Automatically generated by Minions Farm*

steps:
  - id: setup
    name: Checkout Base Branch
    type: git
    action: git.checkout
    config:
      branch: "${workItem.defaultBranch || 'main'}"
      customLabel: "üå≥ Checkout Base"
      customDescription: "Switches to base branch (main/master)"
    retryCount: 1
    continueOnError: false

  - id: create-branch
    name: Create Docs Branch
    type: git
    action: git.branch
    config:
      pattern: "docs/${workItem.workItemType || 'docs'}-${workItem.id}"
      customLabel: "üå± Create Branch"
      customDescription: "Creates documentation branch"
    retryCount: 1
    continueOnError: false

  - id: generate-docs
    name: Write Documentation
    type: code
    action: agent.code
    config:
      provider: "opencode"
      model: "zai/glm-4.7"
    timeout: 600000
    retryCount: 1
    continueOnError: false
    prompt: |
      Generate comprehensive documentation for the codebase. Focus on:

      1. **Functions and Methods**: Add JSDoc/TSDoc comments with:
         - Clear description of what the function does
         - @param tags for all parameters with types and descriptions
         - @returns tag with return type and description
         - @throws tags for exceptions that may be thrown
         - @example tags with usage examples when helpful

      2. **Classes and Interfaces**: Document:
         - Class purpose and responsibility
         - Public methods and properties
         - Constructor parameters
         - Usage examples for complex classes

      3. **Modules/Files**: Add file-level documentation explaining:
         - Module purpose
         - Main exports
         - Usage patterns

      4. **Code Style**:
         - Follow existing documentation style in the codebase
         - Use appropriate doc comment format (JSDoc for JavaScript/TypeScript)
         - Keep comments concise but informative
         - Focus on 'why' and 'how', not just 'what' (the code already shows 'what')

      5. **Focus Areas**:
         - Public APIs and exported functions
         - Complex logic that needs explanation
         - Non-obvious implementation details
         - Edge cases and error handling

      Do NOT add documentation to:
      - Private/internal helper functions that are self-explanatory
      - Generated code
      - Third-party dependencies
      - Code that already has good documentation

      Work item context:
      Title: ${workItem.title}
      Description: ${workItem.description}

  - id: commit
    name: Commit Changes
    type: git
    action: git.commit
    config:
      message: "${commitMessage}"
      customLabel: "üíæ Save Changes"
      customDescription: "Commits all changes with message"
    retryCount: 1
    continueOnError: false

  - id: push
    name: Push Changes
    type: git
    action: git.push
    config:
      customLabel: "‚¨ÜÔ∏è Push to Remote"
      customDescription: "Pushes committed changes to remote repository"
    retryCount: 2
    continueOnError: false

  - id: finalize
    name: Create Pull Request
    type: platform
    action: platform.create_pr
    config:
      title: "${prTitle}"
      description: "${prDescription}"
      target: "${workItem.defaultBranch || 'main'}"
      source: "docs/${workItem.workItemType || 'docs'}-${workItem.id}"
      customLabel: "üîÄ Create PR"
      customDescription: "Opens pull request for code review"
    retryCount: 2
    continueOnError: true
